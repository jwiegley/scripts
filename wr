#!/usr/bin/env bash

set -e

ARGS=""
if [[ "$1" == "-f" || "$1" == "--force" ]]; then
    ARGS="--force"
    shift 1
fi

BRANCH="$1"
if [[ $BRANCH =~ johnw/(.+) ]]; then
    BRANCH="${BASH_REMATCH[1]}"
fi

if [[ -f .git ]]; then
    git worktree remove $ARGS $BRANCH
elif [[ -d master ]]; then
    cd master
    git worktree remove $ARGS $BRANCH
else
    cd main
    git worktree remove $ARGS $BRANCH
fi

if ! git branch -D johnw/$BRANCH
then
    git branch -D $BRANCH
fi
